<div class="dialog">
    
    <div *ngIf="!isConfirmationScreen">
        
        <div *ngIf="alertSuccess" class="alert alert-success alert-dismissible fade show" role="alert">
            <strong>Success ! </strong> Data has been updated
        </div>
        <div *ngIf="alertUserNotFound" class="alert alert-danger alert-dismissible fade show" role="alert">
            <strong>Error ! </strong> Failed to Update Data User Not Found!
        </div>
        <div *ngIf="alertError" class="alert alert-danger alert-dismissible fade show" role="alert">
            <strong>Error ! </strong> Internal Error Occured, Please Contact Administrator!
        </div>
        <div *ngIf="alertEmailDuplicateExist" class="alert alert-warning alert-dismissible fade show" role="alert">
            <strong>Error ! </strong> Email Already Used Please Enter Another!
        </div>
        <div *ngIf="alertContactNumDuplicateExist" class="alert alert-warning alert-dismissible fade show" role="alert">
            <strong>Error ! </strong> Contact Number Already Used Please Enter Another!
        </div>
        <div *ngIf="alertEmailContactNumDuplicateExist" class="alert alert-warning alert-dismissible fade show"
            role="alert">
            <strong>Error ! </strong> Contact Number and Email Already Used Please Enter Another!
        </div>
        
        <!-- <button mat-icon-button class="close-button" [mat-dialog-close]="true">
            <mat-icon class="close-icon" color="warn">close</mat-icon>
          </button> -->
          <!-- <button *ngIf="data.status==0" (click)="showConfirmationScreen()" mat-flat-button
          color="green">Activate</button> -->
            <button mat-icon-button class="close-button" (click)="closeWithChangesConfirmation()" >
                <mat-icon class="close-icon" color="warn">close</mat-icon>
            </button>
        <h2 mat-dialog-title>Patient Record</h2>
       
    <mat-dialog-content class="mat-typography">
        
        <mat-tab-group animationDuration="1000ms" (selectedTabChange)="matTabSelect($event)">
            <mat-tab label="Edit">
                <br>
                <br>
                <div class="form-container">
                    <form [formGroup]="recordForm" (submit)="submitEditRecordForm()">
                        <mat-form-field class="form-field" appearance="outline">
                            <mat-label> First Name
                            </mat-label>
                            <input matInput formControlName="firstName" (change)="changeCount = changeCount + 1" (keyup)="setFirstname($event.target.value)" style="text-transform:uppercase"
                                required> 
                        </mat-form-field>
                        &nbsp;
                        <mat-form-field class="form-field" appearance="outline">
                            <mat-label> Middle Name
                            </mat-label>
                            <input matInput formControlName="middleName" (change)="changeCount = changeCount + 1" (keyup)="setMiddlename($event.target.value)" style="text-transform:uppercase">
                        </mat-form-field>
                        &nbsp;
                        <mat-form-field class="form-field" appearance="outline">
                            <mat-label> Last Name
                            </mat-label>
                            <input matInput formControlName="lastName" (change)="changeCount = changeCount + 1" (keyup)="setLastname($event.target.value)" style="text-transform:uppercase"
                                required>
                        </mat-form-field>

                        <br>
                        <mat-form-field class="form-field" appearance="outline">
                            <mat-label> Email
                            </mat-label>
                            <input matInput formControlName="email" email type="email" class="form-control"
                            (change)="changeCount = changeCount + 1" (keyup)="setEmail($event.target.value)" required>
                        </mat-form-field>
                        &nbsp;
                        <mat-form-field appearance="fill" [style.width.%]="30.5">
                            <mat-label>Birthdate</mat-label>
                            <input matInput [max]="maxDate" formControlName="birthdate" [matDatepicker]="picker"
                                value="yyyy-mm-dd" (dateChange)="changeCount = changeCount + 1" (dateChange)="setBirthdate($event.target.value)">
                            <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
                            <mat-datepicker #picker></mat-datepicker>
                        </mat-form-field>
                        &nbsp;
                        <mat-form-field class="form-field" appearance="outline" >
                            <mat-label> Gender
                            </mat-label>
                            <select matNativeControl formControlName="gender" (change)="changeCount = changeCount + 1" (change)="setGender($event.target.value)" style="text-transform:uppercase"
                                required>
                                <option selected disabled></option>
                                <option value="MALE">MALE</option>
                                <option value="FEMALE">FEMALE</option>
                                <option value="OTHERS">OTHERS</option>
                            </select>
                        </mat-form-field>

                        <br>
                        <mat-form-field class="form-field" appearance="outline">
                            <mat-label> Contact Number
                            </mat-label>
                            <input matInput formControlName="contactNumber"
                                (keyup)="setContactNumber($event.target.value)" (change)="changeCount = changeCount + 1" pattern="[0-9]{11}" maxlength=11 style="text-transform:uppercase"
                                required>
                        </mat-form-field>
                        &nbsp;
                        <mat-form-field class="form-field" appearance="outline" [style.width.%]="62.6">
                            <mat-label> Address
                            </mat-label>
                            <input matInput formControlName="address" (change)="changeCount = changeCount + 1" (keyup)="setAddress($event.target.value)" style="text-transform:uppercase"
                                required>
                        </mat-form-field>


                        <mat-form-field *ngIf="data.status==0" class="form-field" appearance="outline">
                            <mat-label> Status
                            </mat-label>
                            <input matInput formControlName="status" [readonly]="true">
                        </mat-form-field>



                    </form>

                </div>

            </mat-tab>

            <mat-tab *ngIf="data.status==1" label="Add Addresses">
                <br>
                <div>
                    <button (click)="createAddress()" mat-flat-button color="primary">Add
                        Address</button>
                </div>
                <form [formGroup]="addressForm" (submit)="submitAddress()">

                    <div *ngIf="!submitted && valid" formArrayName="addressArray" class="submit-form">

                        <div *ngFor="let address of addressArray.controls;let i = index">
                            <mat-form-field class="form-field">
                                <mat-label> Address
                                </mat-label>
                                <input matInput [formControlName]="i" style="text-transform:uppercase" required>
                            </mat-form-field>
                        </div>
                    </div>
                    <br>

                    <button [disabled]="!addressForm.valid" mat-flat-button color="accent">Submit</button>
                </form>

            </mat-tab>


            <mat-tab (click)="updateList()" label="Address List">
                <br>
                <ul>
                    <li *ngFor="let address of addressList">
                        {{address.address}}
                    </li>
                </ul>
            </mat-tab>

        </mat-tab-group>
        <div class="row">
            <div class="column first" >
                <mat-dialog-actions >
                <button mat-flat-button *ngIf="isEdit" [disabled]="recordForm.invalid" mat-button
                (click)="submitEditRecordForm()" color="accent">Update</button>
                </mat-dialog-actions>
            </div>
            <div class="column second" >
                <mat-dialog-actions align="end">

                    <!-- <button mat-flat-button color="warn" mat-dialog-close>Close</button> -->
                    <button *ngIf="data.status==0" (click)="showConfirmationScreen()" mat-flat-button
                        color="green">Activate</button>
                    <button *ngIf="data.status==1" (click)="showConfirmationScreenDeactivate()" mat-flat-button
                        color="red">Deactivate</button>
        
                    <button *ngIf="!isEdit&&data.status==1" mat-button (click)="editRecord()">Edit Record</button>
                    <button *ngIf="isEdit" mat-button (click)="closeEdit()">Close Edit</button>
        
        
                </mat-dialog-actions>
            </div>
          </div>
               
           
       

    </mat-dialog-content>
</div>

<div *ngIf="isConfirmationScreen" class="form-container">
    <mat-dialog-content class="confirm-typography">
        <h2 mat-dialog-title>Attention!</h2>
        <mat-dialog-content>
            <div *ngIf="data.status==1&&!closeUpdateButtonCLicked">
                <p>
                    Would you like to <strong>Deactivate</strong> this patient record?
                </p>
            </div>
            <div *ngIf="data.status==0">
                <p>
                    Would you like to <strong>Activate</strong> this patient record?
                </p>
            </div>
            <div *ngIf="closeUpdateButtonCLicked">
                <p>
                   There are <strong>unsaved changes</strong> do you wish to continue ?
                </p>
            </div>
        </mat-dialog-content>
        <mat-dialog-actions align="end" class="confirm-container">
            <button mat-button (click)="showConfirmationScreen()"> Cancel</button>
            <button [mat-dialog-close]="true" mat-raised-button *ngIf="closeUpdateButtonCLicked"
                color="red">OK</button>
            <button (click)="activateRecord()" *ngIf="actionSelected" mat-dialog-close mat-raised-button
                color="green">Activate</button>
            <button (click)="deactivateRecord()" *ngIf="!actionSelected&&!closeUpdateButtonCLicked" mat-dialog-close mat-raised-button
                color="red">Deactivate</button>
        </mat-dialog-actions>
    </mat-dialog-content>
</div>